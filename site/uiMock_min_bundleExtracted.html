<!DOCTYPE html><html><head><meta charset="UTF-8"><title>{SolBeats();}</title><style>.title{color:#fff;margin:0;font-size:20px;font-family:Monospace;font-weight:600}body{background-color:#000;color:#fff;margin:0;font-size:18px;font-family:Monospace}.header-bar{display:flex;justify-content:space-between;align-items:center;padding:10px;height:35px;background-color:gray;position:fixed;top:0;width:100%;z-index:999}.top-right{display:flex;align-items:center;right:10px;padding-right:15px}.dot{width:10px;height:10px;border-radius:50%;margin-right:10px}.dot-red{background-color:red}.dot-green{background-color:green}.connect-button,.switch-button{display:none;padding:5px 10px;font-size:14px}.web3{display:none;text-align:center;margin-top:60px}.content{width:90%;display:flex;flex-direction:column;align-items:center;padding:20px}.input-container{width:88%;margin-top:20px;padding:10px}input{width:100%;padding:5px;margin-bottom:10px}.button-container{display:flex;justify-content:center}button{padding:10px 20px;height:40px;margin:15px 5px;font-size:16px}.options-container{display:flex;justify-content:space-between;margin-bottom:1em}.options-container label{display:flex;flex-direction:column;width:100%;margin-right:10px}.options-container input,.options-container select{margin-top:.5em;height:30px;width:100%;box-sizing:border-box;padding:3px}.audio-div{margin-top:10px;display:block;clear:both}.iframe{display:none;position:fixed;top:20px;right:20px;background-color:rgba(255,0,0,.8);padding:10px;border-radius:5px;color:#fff;z-index:9999}.arrow{width:0;height:0;border-style:solid;border-width:10px;border-color:transparent transparent rgba(255,0,0,.8) transparent;position:absolute;top:-20px;right:25px}</style><link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet"><script src="https://cdn.jsdelivr.net/npm/ganache@7.8.0/dist/web/ganache.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.5.1/ethers.umd.min.js"></script></head><body><div class="header-bar"><div class="title">{SolBeats();}</div><div class="top-right"><div class="dot"></div><button class="connect-button">Connect Wallet</button><button class="switch-button">Switch to Arbitrum</button></div></div><div class="web3"><div class="content"><div class="input-container"><input type="text" placeholder="Enter a beat formula, using a single variable `t`, ex. (t>>4)*(t>>3)|t>>2"></div><div class="button-container"><div class="options-container"><label>Sample Rate (Hz):<select id="sampleRate"><option value="8000" selected="selected">8000</option><option value="11025">11025</option><option value="22050">22050</option></select></label><label>Length (seconds):<select id="length"><option value="1">1</option><option value="2">2</option><option value="5">5</option><option value="15">15</option><option value="30">30</option><option value="60" selected="selected">60</option></select></label><label>Offset (samples): <input type="number" id="value" min="0" value="0"></label></div><button class="play-button" title="This will create a local blockchain in your browser and deploy a test contract, it may take a few moments to generate. Please be patient">Demo</button><button class="mint-button">Mint</button></div></div></div><div class="iframe"><div class="arrow"></div><span class="body">Please click "View Original Media"</span><span class="material-icons-outlined">open_in_new</span><span class="body">to enable Web3 features</span></div><script>function compileContract(l,Z){return new Promise((m,b)=>{let d=atob("//[@bundle extracted]//"),c=[];for(let G=0;G<d.length;G+=512){let i=d.slice(G,G+512),X=new Uint8Array(i.length);for(let $=0;$<i.length;$++)X[$]=i.charCodeAt($);c.push(X)}let W=new Blob(c,{type:"application/javascript"}),I=URL.createObjectURL(W);var V=new Worker(I);V.addEventListener("message",function(l){let Z=l.data.output;m(Z)},!1);let y="8000",u=Z?`contract BEAT_TEST { uint32 public constant OFFSET = 0; uint32 public constant SAMPLE_RATE = ${y}; uint32 public constant LENGTH = SAMPLE_RATE; function getBeat() external pure returns (string memory) { bytes memory buffer = new bytes(LENGTH); for(uint256 t = OFFSET; t<LENGTH+OFFSET; ++t) { buffer[t-OFFSET] = bytes1(uint8(${l})); } return WAV_8BIT.encodeWAV(buffer, SAMPLE_RATE); }}library WAV_8BIT { bytes4 constant RIFF_HDR = hex'52494646'; bytes16 constant WAV_FMT_HDR = hex'57415645666d74201000000001000100';  function reverse(uint32 input) internal pure returns (uint32 v) { v = input; v = ((v & 0xFF00FF00) >> 8) | ((v & 0x00FF00FF) << 8); v = (v >> 16) | (v << 16); } function fmtByteRate(uint32 sampleRate) internal pure returns (bytes12) { bytes4 lsbSampleRate = bytes4(reverse(sampleRate)); return bytes12( bytes.concat( lsbSampleRate, lsbSampleRate, hex'01000800' ) ); } function formatDataChunk(bytes memory audioData) internal pure returns (bytes memory) { return bytes.concat( bytes4('data'), bytes4(reverse(uint32(audioData.length))), audioData ); } function encodeWAV(bytes memory _audioData, uint32 _sampleRate) internal pure returns (string memory) { uint32 audioSize = uint32(_audioData.length); return string.concat( 'data:audio/wav;base64,', Base64.encode( bytes.concat( RIFF_HDR, bytes4(reverse(audioSize+12)), WAV_FMT_HDR, bytes12(fmtByteRate(_sampleRate)), formatDataChunk(_audioData) ) ) ); } }library Base64 { function encode(bytes memory data) internal pure returns (string memory result) { bool fileSafe = false; bool noPadding = false;  assembly { let dataLength := mload(data) if dataLength { let encodedLength := shl(2, div(add(dataLength, 2), 3)) result := mload(0x40) mstore(0x1f, "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdef") mstore(0x3f, sub("ghijklmnopqrstuvwxyz0123456789-_", mul(iszero(fileSafe), 0x0230))) let ptr := add(result, 0x20) let end := add(ptr, encodedLength) for {} 1 {} { data := add(data, 3) let input := mload(data) mstore8(0, mload(and(shr(18, input), 0x3F))) mstore8(1, mload(and(shr(12, input), 0x3F))) mstore8(2, mload(and(shr(6, input), 0x3F))) mstore8(3, mload(and(input, 0x3F))) mstore(ptr, mload(0x00)) ptr := add(ptr, 4) if iszero(lt(ptr, end)) { break } } mstore(0x40, add(end, 0x20)) let o := div(2, mod(dataLength, 3)) mstore(sub(ptr, o), shl(240, 0x3d3d)) o := mul(iszero(iszero(noPadding)), o) mstore(sub(ptr, o), 0) mstore(result, sub(encodedLength, o)) } } }}`:`contract BEAT {uint32 public constant OFFSET = 0; uint32 public constant SAMPLE_RATE = ${y}; uint32 public constant LENGTH = SAMPLE_RATE * 60; function getBeat() external pure returns (bytes memory, uint32) { bytes memory buffer = new bytes(LENGTH); unchecked{ for(uint256 t = OFFSET; t<LENGTH+OFFSET; ++t) { buffer[t-OFFSET] = bytes1(uint8(${l})); } } return (buffer, SAMPLE_RATE); } }`;V.postMessage({contractCode:u})})}</script><script>function setDotColor(e){document.querySelector(".dot").style.backgroundColor=e}function getCompiledContract(e,t){return new Promise(function(n,o){compileContract(e,t).then(e=>{for(var t in e.contracts.contract){let o=e.contracts.contract[t].evm.bytecode.object;console.log(`Bytecode of contract ${t}: ${o}`),n(o)}}).catch(e=>{window.alert("This could not compile. Please ensure that it is a valid single line of Solidity."),console.error(e)})})}async function deployAndCallContract(e){let t=await new ethers.BrowserProvider(Ganache.provider({miner:{blockGasLimit:"0xffffffffffffffffffffffffffffffff",callGasLimit:"0xffffffffffffffffffffffffffffffff",defaultGasLimit:"0x0000"}})).getSigner(0),n=new ethers.ContractFactory(["function getBeat() pure returns (string memory)"],e,t),o=await n.deploy();await o.deploymentTransaction().wait();try{let r=await o.getBeat(),a=document.createElement("audio");a.src=r,a.autoplay=!0,a.controls=!0,a.loop=!0;let l=document.querySelector(".button-container").parentElement,c=l.querySelector(".audio-div");c&&l.removeChild(c);let i=document.createElement("div");i.className="audio-div",i.appendChild(a),l.appendChild(i)}catch(f){window.alert("The contract did not return a valid beat."),console.error("Error calling getBeat:",f)}}async function mintToken(e,t){try{let n=new ethers.Interface(["function mint(bytes calldata bytecode, string calldata beatString) public payable"]),o=await new ethers.Contract("0x4a55CBAc33cfF6149510D498E2B1D314678688e7",n,await (await new ethers.BrowserProvider(window.ethereum)).getSigner()),r=ethers.parseEther("0.0025");console.log("compiled contract",`0x${e}`);let a=await (await o.mint(`0x${e}`,t,{value:r})).wait();console.log(`Transaction was mined in block ${a.blockNumber}`)}catch(l){console.error(`Failed to mint token: ${l}`)}}document.addEventListener("DOMContentLoaded",function(){if(window==window.top){var e=document.querySelector(".web3"),t=document.querySelector(".connect-button"),n=document.querySelector(".switch-button"),o=document.querySelector(".mint-button"),r=document.querySelector(".play-button");e.style.display="block",void 0!==window.ethereum?(window.ethereum.request({method:"eth_requestAccounts"}),ethereum.request({method:"eth_accounts"}).then(function(e){0===e.length?(setDotColor("red"),t.style.display="block",n.style.display="none"):ethereum.request({method:"eth_chainId"}).then(function(e){"0x66eed"===e?(setDotColor("green"),t.style.display="none",n.style.display="none"):(setDotColor("red"),t.style.display="none",n.style.display="block")}).catch(console.error)}).catch(console.error),t.addEventListener("click",function(){ethereum.request({method:"eth_requestAccounts"}).then(function(e){e.length>0&&(setDotColor("green"),t.style.display="none",n.style.display="none")}).catch(console.error)}),n.addEventListener("click",function(){window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:"0x66eed",rpcUrls:["https://arbitrum-goerli.publicnode.com"],chainName:"Arbitrum Goerli",nativeCurrency:{name:"Arbitrum Goerli",symbol:"AETH",decimals:18},blockExplorerUrls:["https://goerli.arbiscan.io/"]}]}).then(function(){n.style.display="none"}).catch(console.error)}),o.addEventListener("click",async function(){var e=document.querySelector('input[type="text"]').value;if(!e){alert("Please enter a line");return}var t=await getCompiledContract(e,!1);console.log("compiled contract:",t),mintToken(t,e)}),r.addEventListener("click",async function(){var e=document.querySelector('input[type="text"]').value;if(!e){alert("Please enter a line");return}var t=await getCompiledContract(e,!0);console.log("compiled test contract:",t),deployAndCallContract(t)})):(setDotColor("red"),t.style.display="block",n.style.display="none")}else document.querySelector(".iframe").style.display="block"});</script></body></html>